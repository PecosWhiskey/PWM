<ion-header [translucent]="true" class="vaygo-header">
  <ion-toolbar>
    <ion-title>Profilo</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="vaygo-content">
  
  <!-- Stato LOGGED IN -->
  <div *ngIf="isLoggedIn" class="logged-in-container">
    
    <!-- Header Profilo -->
    <div class="profile-header">
      <div class="profile-avatar">
        <ion-icon name="person" class="avatar-icon"></ion-icon>
      </div>
      <h2 class="profile-name">{{ user.name }}</h2>
      <p class="profile-email">{{ user.email }}</p>
    </div>

    <!-- Statistiche Utente -->
    <div class="profile-stats">
      <ion-card class="stat-card">
        <ion-card-content>
          <div class="stat-value">{{ user.flights }}</div>
          <div class="stat-label">Voli</div>
        </ion-card-content>
      </ion-card>
      
      <ion-card class="stat-card">
        <ion-card-content>
          <div class="stat-value">{{ user.miles }}</div>
          <div class="stat-label">Miglia</div>
        </ion-card-content>
      </ion-card>
      
      <ion-card class="stat-card">
        <ion-card-content>
          <div class="stat-value">{{ user.status }}</div>
          <div class="stat-label">Status</div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Menu Profilo -->
    <ion-card class="profile-menu-card">
      <ion-list lines="full">
        
        <ion-item button (click)="navigateToTickets()" class="menu-item">
          <ion-icon name="ticket" slot="start" class="menu-icon"></ion-icon>
          <ion-label>Biglietti</ion-label>
          <ion-icon name="chevron-forward" slot="end" class="chevron-icon"></ion-icon>
        </ion-item>
        
        <ion-item button (click)="navigateToLoyalty()" class="menu-item">
          <ion-icon name="star" slot="start" class="menu-icon"></ion-icon>
          <ion-label>Programma fedelt√†</ion-label>
          <ion-icon name="chevron-forward" slot="end" class="chevron-icon"></ion-icon>
        </ion-item>
        
        <ion-item button (click)="navigateToNotifications()" class="menu-item">
          <ion-icon name="notifications" slot="start" class="menu-icon"></ion-icon>
          <ion-label>Notifiche</ion-label>
          <ion-badge color="danger" *ngIf="notificationCount > 0">{{ notificationCount }}</ion-badge>
          <ion-icon name="chevron-forward" slot="end" class="chevron-icon"></ion-icon>
        </ion-item>
        
        <ion-item button (click)="openSupportPopup()" class="menu-item">
          <ion-icon name="help-circle" slot="start" class="menu-icon"></ion-icon>
          <ion-label>Aiuto & Supporto</ion-label>
          <ion-icon name="chevron-forward" slot="end" class="chevron-icon"></ion-icon>
        </ion-item>
        
      </ion-list>
    </ion-card>

    <!-- Pulsante Logout -->
    <div class="logout-section">
      <ion-button 
        expand="block" 
        class="logout-btn" 
        color="danger"
        (click)="logout()">
        <ion-icon name="log-out" slot="start"></ion-icon>
        Logout
      </ion-button>
    </div>
    
  </div>

  <!-- Stato LOGGED OUT -->
  <div *ngIf="!isLoggedIn" class="logged-out-container">
    
    <!-- Messaggio di benvenuto -->
    <ion-card class="welcome-card">
      <ion-card-header>
        <ion-card-title class="welcome-title">Benvenuto in VayGo Airlines</ion-card-title>
        <ion-card-subtitle class="welcome-subtitle">
          Accedi al tuo account per gestire i tuoi voli, controllare le tue miglia e molto altro.
        </ion-card-subtitle>
      </ion-card-header>
    </ion-card>

    <!-- Form di Login -->
    <ion-card class="login-card">
      <ion-card-header>
        <ion-card-title class="login-title">Accedi</ion-card-title>
        <ion-card-subtitle class="login-subtitle">
          Inserisci le tue credenziali per continuare
        </ion-card-subtitle>
      </ion-card-header>
      
      <ion-card-content>
        <form [formGroup]="loginForm" (ngSubmit)="onLogin()">
          
          <ion-item class="vaygo-input" lines="none">
            <ion-icon name="mail" slot="start"></ion-icon>
            <ion-input 
              type="email" 
              placeholder="La tua email"
              formControlName="email"
              [class.ion-invalid]="loginForm.get('email')?.invalid && loginForm.get('email')?.touched">
            </ion-input>
          </ion-item>
          
          <ion-item class="vaygo-input" lines="none">
            <ion-icon name="lock-closed" slot="start"></ion-icon>
            <ion-input 
              type="password" 
              placeholder="La tua password"
              formControlName="password"
              [class.ion-invalid]="loginForm.get('password')?.invalid && loginForm.get('password')?.touched">
            </ion-input>
          </ion-item>
          
          <!-- Messaggi di errore -->
          <div class="error-messages" *ngIf="loginForm.get('email')?.invalid && loginForm.get('email')?.touched">
            <ion-text color="danger">
              <small>Email non valida</small>
            </ion-text>
          </div>
          
          <div class="error-messages" *ngIf="loginForm.get('password')?.invalid && loginForm.get('password')?.touched">
            <ion-text color="danger">
              <small>Password richiesta</small>
            </ion-text>
          </div>
          
          <ion-button 
            expand="block" 
            type="submit" 
            class="vaygo-btn-primary login-btn"
            [disabled]="loginForm.invalid || isLoading">
            <ion-icon name="log-in" slot="start" *ngIf="!isLoading"></ion-icon>
            <ion-spinner name="crescent" *ngIf="isLoading"></ion-spinner>
            {{ isLoading ? 'Accesso in corso...' : 'Accedi' }}
          </ion-button>
          
        </form>
        
        <!-- Footer del form -->
        <div class="form-footer">
          <p>
            Non hai un account? 
            <ion-button fill="clear" size="small" (click)="navigateToRegister()">
              Registrati
            </ion-button>
          </p>
          <p>
            <ion-button fill="clear" size="small" (click)="navigateToForgotPassword()">
              Password dimenticata?
            </ion-button>
          </p>
        </div>
        
      </ion-card-content>
    </ion-card>

    <!-- Registrazione alternativa -->
    <div class="register-section">
      <ion-button 
        expand="block" 
        fill="outline" 
        class="vaygo-btn-secondary"
        (click)="navigateToRegister()">
        <ion-icon name="person-add" slot="start"></ion-icon>
        Crea nuovo account
      </ion-button>
    </div>
    
  </div>

  <ion-modal [isOpen]="isSupportPopupOpen" (ionModalDidDismiss)="closeSupportPopup()">
    <ion-header>
      <ion-toolbar>
        <ion-title>Aiuto & Supporto</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeSupportPopup()">Chiudi</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content>
      <div class="support-info">
        <ion-card>
          <ion-card-content>
            <h3>Contatti</h3>
            <p>Siamo qui per aiutarti</p>
            
            <ion-item lines="none">
              <ion-icon name="call" slot="start" color="primary"></ion-icon>
              <ion-label>
                <h4>Telefono</h4>
                <p>+39 123 456 789</p>
              </ion-label>
            </ion-item>
            
            <ion-item lines="none">
              <ion-icon name="mail" slot="start" color="primary"></ion-icon>
              <ion-label>
                <h4>Email</h4>
                <p>support&#64;vaygoairlines.com</p>
              </ion-label>
            </ion-item>
            
            <ion-item lines="none">
              <ion-icon name="time" slot="start" color="primary"></ion-icon>
              <ion-label>
                <h4>Orari</h4>
                <p>Lun-Ven: 8:00-20:00<br>Sab-Dom: 9:00-18:00</p>
              </ion-label>
            </ion-item>
          </ion-card-content>
        </ion-card>
      </div>
    </ion-content>

